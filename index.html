<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Snake Game Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(180deg,#0f172a,#020617);
    font-family:Arial,sans-serif;
    color:#e5e7eb;
}
.container{
    position:relative;
    text-align:center;
}
canvas{
    background:#020617;
    border-radius:16px;
    box-shadow:0 0 15px rgba(56,189,248,.3);
}
button{
    background:#1e293b;
    color:#e5e7eb;
    border:none;
    padding:8px 18px;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}
button:hover{background:#334155}

.info{
    display:flex;
    justify-content:space-between;
    margin-top:6px;
    font-size:14px;
}

.overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,.8);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:10;
}

.count{
    font-size:64px;
    animation:pulse .8s infinite;
}

.dead{
    font-size:48px;
    color:#ff4d4d;
    text-shadow:0 0 15px red;
    animation:shake .4s infinite;
}

@keyframes pulse{
    0%{transform:scale(1)}
    50%{transform:scale(1.2)}
    100%{transform:scale(1)}
}
@keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-5px)}
    50%{transform:translateX(5px)}
    75%{transform:translateX(-5px)}
    100%{transform:translateX(0)}
}
</style>
</head>

<body>
<div class="container">
<h2>üêç SNAKE GAME</h2>

<canvas id="game" width="360" height="360"></canvas>

<div class="info">
    <div>Score: <span id="score">0</span></div>
    <div>High: <span id="high">0</span></div>
</div>

<div style="margin-top:8px">
    <button onclick="togglePause()" id="pauseBtn">‚è∏ D·ª™NG</button>
</div>

<!-- START -->
<div class="overlay" id="startScreen">
    <button onclick="startCountdown()">‚ñ∂ B·∫ÆT ƒê·∫¶U</button>
</div>

<!-- COUNTDOWN -->
<div class="overlay" id="countdown" style="display:none">
    <div class="count" id="countText">3</div>
</div>

<!-- DEATH -->
<div class="overlay" id="deathScreen" style="display:none">
    <div class="dead">üíÄ ƒÇN C·ª®T R·ªíI üíÄ</div>
</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 20;

let snake, food, dir;
let score = 0;
let speed = 220;
let game = null;
let running = false;
let paused = false;

const eat = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.wav");
const dead = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.wav");

let high = localStorage.getItem("snake_high") || 0;
document.getElementById("high").innerText = high;

function vibrate(p){
    if(navigator.vibrate) navigator.vibrate(p);
}

function rand(){
    return {
        x: Math.floor(Math.random()*18)*box,
        y: Math.floor(Math.random()*18)*box
    };
}

function reset(){
    snake = [{x:9*box,y:9*box}];
    food = rand();
    dir = "RIGHT";
    score = 0;
    speed = 220;
}

function startCountdown(){
    document.getElementById("startScreen").style.display="none";
    document.getElementById("countdown").style.display="flex";
    let c=3;
    document.getElementById("countText").innerText=c;
    const t=setInterval(()=>{
        c--;
        document.getElementById("countText").innerText=c;
        if(c===0){
            clearInterval(t);
            document.getElementById("countdown").style.display="none";
            startGame();
        }
    },1000);
}

function startGame(){
    reset();
    running=true;
    paused=false;
    clearInterval(game);
    game=setInterval(draw,speed);
}

function togglePause(){
    if(!running) return;
    const btn=document.getElementById("pauseBtn");
    if(!paused){
        clearInterval(game);
        paused=true;
        btn.innerText="‚ñ∂ TI·∫æP";
    }else{
        game=setInterval(draw,speed);
        paused=false;
        btn.innerText="‚è∏ D·ª™NG";
    }
}

document.addEventListener("keydown",e=>{
    if(!running || paused) return;
    if(e.key==="ArrowUp" && dir!=="DOWN") dir="UP";
    if(e.key==="ArrowDown" && dir!=="UP") dir="DOWN";
    if(e.key==="ArrowLeft" && dir!=="RIGHT") dir="LEFT";
    if(e.key==="ArrowRight" && dir!=="LEFT") dir="RIGHT";
});

function draw(){
    ctx.clearRect(0,0,360,360);

    // FOOD
    ctx.fillStyle="#ef4444";
    ctx.fillRect(food.x,food.y,box,box);

    // SNAKE
    snake.forEach((p,i)=>{
        if(i===0){
            ctx.fillStyle="#38bdf8";
            ctx.beginPath();
            ctx.arc(p.x+box/2,p.y+box/2,box/2,0,Math.PI*2);
            ctx.fill();

            ctx.fillStyle="#000";
            ctx.beginPath();
            ctx.arc(p.x+box*0.35,p.y+box*0.35,2,0,Math.PI*2);
            ctx.arc(p.x+box*0.65,p.y+box*0.35,2,0,Math.PI*2);
            ctx.fill();
        }else{
            ctx.fillStyle="#22d3ee";
            ctx.beginPath();
            ctx.roundRect(p.x,p.y,box,box,8);
            ctx.fill();
        }
    });

    let h={...snake[0]};
    if(dir==="UP")h.y-=box;
    if(dir==="DOWN")h.y+=box;
    if(dir==="LEFT")h.x-=box;
    if(dir==="RIGHT")h.x+=box;

    if(h.x<0||h.y<0||h.x>=360||h.y>=360||
       snake.some((p,i)=>i>0&&p.x===h.x&&p.y===h.y)){
        return gameOver();
    }

    if(h.x===food.x && h.y===food.y){
        score++;
        eat.play();
        vibrate(50);
        food=rand();

        if(score % 10 === 0){
            speed /= 1.5;
            clearInterval(game);
            game=setInterval(draw,speed);
        }
    }else{
        snake.pop();
    }

    snake.unshift(h);
    document.getElementById("score").innerText=score;
}

function gameOver(){
    clearInterval(game);
    running=false;
    paused=false;
    dead.play();
    vibrate([200,100,200,100,400]);

    if(score>high){
        high=score;
        localStorage.setItem("snake_high",high);
        document.getElementById("high").innerText=high;
    }

    document.getElementById("deathScreen").style.display="flex";

    setTimeout(()=>{
        document.getElementById("deathScreen").style.display="none";
        startCountdown();
    },3000);
}
</script>
</body>
</html>
